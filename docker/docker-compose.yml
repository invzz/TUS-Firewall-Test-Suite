services:
  nftables-test:
    build:
      context: ..
      dockerfile: docker/Dockerfile.server
    container_name: nftables-test-container
    privileged: true
    network_mode: host
    volumes:
      - ../config/nftables.conf:/etc/nftables/nftables.conf:ro
      - ../src/utils/test-nftables.sh:/usr/local/bin/test-nftables.sh:ro
      - ../src/utils/enhanced-test.sh:/usr/local/bin/enhanced-test.sh:ro
      - ../src/server/nftables-test-server.py:/usr/local/bin/nftables-test-server.py:ro
      - ../scripts/run-auto-tests.sh:/usr/local/bin/run-auto-tests.sh:ro
      - ../results:/shared
    environment:
      - TERM=xterm-256color
      - KEEP_RUNNING=false
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN